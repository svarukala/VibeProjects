<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgentAnalyzer - Copilot Agent Analysis Tool</title>

    <!-- MSAL.js - Load first in head for authentication -->
    <script src="https://alcdn.msauth.net/browser/2.35.0/js/msal-browser.min.js"></script>

    <!-- Fluent UI Web Components -->
    <script type="module" src="https://unpkg.com/@fluentui/web-components"></script>

    <!-- Monaco Editor -->
    <link rel="stylesheet" href="https://unpkg.com/monaco-editor@0.45.0/min/vs/editor/editor.main.css">

    <!-- Prism.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">

    <!-- App Styles -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/fluent-overrides.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <div class="app-logo">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="32" height="32" rx="4" fill="#0078D4"/>
                        <path d="M8 12h16M8 16h12M8 20h14" stroke="white" stroke-width="2" stroke-linecap="round"/>
                        <circle cx="24" cy="20" r="4" fill="#50E6FF"/>
                    </svg>
                </div>
                <h1 class="app-title">AgentAnalyzer</h1>
            </div>
            <div class="header-right">
                <div id="user-info" class="user-info hidden">
                    <span id="user-name"></span>
                    <fluent-button id="sign-out-btn" appearance="subtle">Sign Out</fluent-button>
                </div>
                <fluent-button id="sign-in-btn" appearance="accent">Sign In</fluent-button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="app-main">
            <!-- Upload Area (shown when no file loaded) -->
            <div id="upload-area" class="upload-area">
                <div class="upload-section">
                    <div id="drop-zone" class="drop-zone">
                        <div class="drop-zone-content">
                            <svg class="upload-icon" width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 16V8M12 8L9 11M12 8L15 11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M3 15V16C3 18.2091 4.79086 20 7 20H17C19.2091 20 21 18.2091 21 16V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <h2>Drop your Copilot Agent ZIP file here</h2>
                            <p>or click to browse</p>
                            <input type="file" id="file-input" accept=".zip" hidden>
                            <fluent-button id="browse-btn" appearance="accent">Browse Files</fluent-button>
                        </div>
                    </div>
                    <div class="upload-info">
                        <p>Supported: Microsoft 365 Copilot Agent packages (.zip)</p>
                    </div>
                </div>

                <!-- Agent History Panel -->
                <div id="history-container" class="history-container">
                    <div class="history-title">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M10 2a8 8 0 1 0 0 16 8 8 0 0 0 0-16zM2 10a8 8 0 1 1 16 0 8 8 0 0 1-16 0z"/>
                            <path d="M10 4a.75.75 0 0 1 .75.75v4.5h3a.75.75 0 0 1 0 1.5h-3.75a.75.75 0 0 1-.75-.75v-5.25A.75.75 0 0 1 10 4z"/>
                        </svg>
                        <h3>Recent Agents</h3>
                    </div>
                    <div id="history-list" class="history-list"></div>
                </div>
            </div>

            <!-- Workspace (shown when file loaded) -->
            <div id="workspace" class="workspace hidden">
                <!-- Left Panel - File Tree -->
                <aside class="left-panel">
                    <div class="panel-header">
                        <h3>Files</h3>
                        <fluent-button id="close-package-btn" appearance="subtle" title="Close Package">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                            </svg>
                        </fluent-button>
                    </div>
                    <div id="file-tree" class="file-tree"></div>
                </aside>

                <!-- Main Panel with Tabs -->
                <section class="main-panel">
                    <!-- Main Workspace Tabs -->
                    <div class="workspace-tabs">
                        <!-- Fixed Tabs -->
                        <div class="fixed-tabs">
                            <button class="workspace-tab active" data-tab="details">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z"/>
                                </svg>
                                <span>Details</span>
                            </button>
                            <button class="workspace-tab" data-tab="analyzer">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                                </svg>
                                <span>Analyzer</span>
                                <span id="analysis-badge" class="tab-badge hidden">!</span>
                            </button>
                        </div>
                        <!-- Dynamic File Tabs -->
                        <div id="file-tabs" class="file-tabs"></div>
                        <!-- Agent Info in Tab Bar -->
                        <div class="tab-agent-info">
                            <div class="agent-type-badge" id="agent-type-badge">Loading...</div>
                            <span id="agent-name" class="agent-name-display">Agent Name</span>
                        </div>
                    </div>

                    <!-- Tab Content Container -->
                    <div class="tab-content-container">
                        <!-- Details Tab Content -->
                        <div id="tab-details" class="tab-content active">
                            <!-- Agent Details Summary -->
                            <div class="details-summary details-full">
                                <div class="detail-item">
                                    <label>Description:</label>
                                    <p id="agent-description">-</p>
                                </div>
                                <div class="detail-item expandable">
                                    <div class="expandable-header" id="instructions-toggle">
                                        <label>Instructions:</label>
                                        <button class="expand-btn" title="Expand/Collapse">
                                            <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
                                                <path d="M2 4l4 4 4-4" stroke="currentColor" stroke-width="2" fill="none"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <div id="instructions-content" class="expandable-content">
                                        <pre id="agent-instructions">-</pre>
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <label>Capabilities:</label>
                                    <div id="agent-properties" class="capabilities-pills"></div>
                                </div>
                                <div class="detail-item" id="starter-prompts-section">
                                    <label>Starter Prompts:</label>
                                    <div id="starter-prompts" class="starter-prompts-list"></div>
                                </div>
                            </div>
                        </div>

                        <!-- File Editor Tab Content (shared by all file tabs) -->
                        <div id="tab-file-editor" class="tab-content">
                            <div id="file-viewer" class="file-viewer-panel">
                                <div class="viewer-header">
                                    <div class="viewer-title">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                            <path d="M5 4a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1H5zm-.5 2.5A.5.5 0 0 1 5 6h6a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5zM5 8a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1H5zm0 2a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1H5z"/>
                                            <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2zm10-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1z"/>
                                        </svg>
                                        <h3 id="current-file-name">Select a file to view</h3>
                                    </div>
                                    <div class="viewer-actions" id="editor-actions">
                                        <fluent-button id="undo-btn" appearance="subtle" disabled title="Undo">
                                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                                <path d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/>
                                                <path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"/>
                                            </svg>
                                        </fluent-button>
                                        <fluent-button id="save-btn" appearance="accent" disabled>Save</fluent-button>
                                        <fluent-button id="cancel-btn" appearance="subtle" disabled>Cancel</fluent-button>
                                    </div>
                                </div>
                                <div class="viewer-body">
                                    <div id="editor-container" class="editor-container"></div>
                                    <div id="image-preview" class="image-preview hidden">
                                        <img id="preview-image" src="" alt="Preview">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Analyzer Tab Content -->
                        <div id="tab-analyzer" class="tab-content">
                            <!-- Analysis Controls -->
                            <div class="analysis-controls">
                                <div class="analysis-section basic-analysis">
                                    <h4>Basic Analysis</h4>
                                    <p class="section-desc">AI-powered best practice analysis of your agent configuration</p>
                                    <fluent-button id="analyze-btn" appearance="accent" disabled>
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="margin-right: 8px;">
                                            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                                        </svg>
                                        Analyze Agent
                                    </fluent-button>
                                </div>

                                <div class="analysis-section deep-analysis">
                                    <div class="section-header">
                                        <h4>Deep Analysis</h4>
                                        <span id="sign-in-required" class="sign-in-hint">(requires sign-in)</span>
                                    </div>
                                    <p class="section-desc">Analyze connected resources and data sources</p>
                                    <div class="deep-analysis-options">
                                        <label class="checkbox-item">
                                            <input type="checkbox" id="chk-sharepoint" disabled>
                                            <span class="checkbox-label">
                                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                                    <path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4H3.5A1.5 1.5 0 0 0 2 8.5v5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5v-5A1.5 1.5 0 0 0 12.5 7H11z"/>
                                                </svg>
                                                SharePoint Knowledge Sources
                                            </span>
                                        </label>
                                        <label class="checkbox-item">
                                            <input type="checkbox" id="chk-copilot-connectors" disabled>
                                            <span class="checkbox-label">
                                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                                    <path d="M6 3.5A1.5 1.5 0 0 1 7.5 2h1A1.5 1.5 0 0 1 10 3.5v1A1.5 1.5 0 0 1 8.5 6h-1A1.5 1.5 0 0 1 6 4.5v-1zM1 8a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 8zm0 3.5a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13a.5.5 0 0 1-.5-.5z"/>
                                                </svg>
                                                Copilot Connectors
                                            </span>
                                        </label>
                                        <label class="checkbox-item">
                                            <input type="checkbox" id="chk-api-connectors" disabled>
                                            <span class="checkbox-label">
                                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                                    <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
                                                    <path d="M6.854 4.646a.5.5 0 0 1 0 .708L4.207 8l2.647 2.646a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 0 1 .708 0zm2.292 0a.5.5 0 0 0 0 .708L11.793 8l-2.647 2.646a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708 0z"/>
                                                </svg>
                                                API Connectors
                                            </span>
                                        </label>
                                    </div>
                                    <fluent-button id="deep-analyze-btn" appearance="outline" disabled>
                                        Run Deep Analysis
                                    </fluent-button>
                                </div>
                            </div>

                            <!-- Analysis Results - Full Height -->
                            <div id="analysis-results" class="analysis-results-panel">
                                <div class="results-header">
                                    <h3>Analysis Results</h3>
                                    <div class="results-summary" id="results-summary"></div>
                                </div>
                                <div class="results-tabs-container">
                                    <div class="results-tab-bar">
                                        <button class="results-tab active" data-panel="basic-results">Basic Analysis</button>
                                        <button class="results-tab" data-panel="sharepoint-results">SharePoint</button>
                                        <button class="results-tab" data-panel="connectors-results">Connectors</button>
                                        <button class="results-tab" data-panel="api-results">APIs</button>
                                    </div>
                                    <div class="results-panels">
                                        <div id="basic-results" class="results-panel active">
                                            <div class="results-placeholder">
                                                <svg width="48" height="48" viewBox="0 0 16 16" fill="currentColor" opacity="0.3">
                                                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                                                </svg>
                                                <p>Click "Analyze Agent" to run analysis</p>
                                            </div>
                                        </div>
                                        <div id="sharepoint-results" class="results-panel">
                                            <div class="results-placeholder">
                                                <p>Run Deep Analysis with SharePoint option enabled</p>
                                            </div>
                                        </div>
                                        <div id="connectors-results" class="results-panel">
                                            <div class="results-placeholder">
                                                <p>Run Deep Analysis with Connectors option enabled</p>
                                            </div>
                                        </div>
                                        <div id="api-results" class="results-panel">
                                            <div class="results-placeholder">
                                                <p>Run Deep Analysis with API Connectors option enabled</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <div class="footer-left">
                <fluent-button id="download-btn" appearance="accent" disabled>
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="margin-right: 8px;">
                        <path d="M8 12l-4-4h2.5V3h3v5H12l-4 4z"/>
                        <path d="M2 14h12v1H2v-1z"/>
                    </svg>
                    Download Package
                </fluent-button>
            </div>
            <div class="footer-right">
                <span id="status-text" class="status-text">Ready</span>
            </div>
        </footer>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="loading-overlay hidden">
            <fluent-progress-ring></fluent-progress-ring>
            <p id="loading-text">Loading...</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>

    <!-- Monaco Editor Loader -->
    <script src="https://unpkg.com/monaco-editor@0.45.0/min/vs/loader.js"></script>

    <!-- Microsoft Graph Client -->
    <script src="https://cdn.jsdelivr.net/npm/@microsoft/microsoft-graph-client/lib/graph-js-sdk.js"></script>

    <!-- App Modules -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
