<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Analyze your Microsoft 365 calendar meetings and get AI-powered recommendations">
    <title>ReduceMeetings - Calendar Meeting Analyzer</title>

    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/responsive.css">

    <!-- MSAL.js from CDN -->
    <script src="https://alcdn.msauth.net/browser/2.35.0/js/msal-browser.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="#" class="logo">
                    <svg class="logo-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm-2 14l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/>
                    </svg>
                    ReduceMeetings
                </a>
                <div class="user-section">
                    <div class="user-info">
                        <img id="user-photo" class="user-photo hidden" alt="User photo" src="">
                        <span id="user-name" class="user-name"></span>
                    </div>
                    <button id="sign-out-btn" class="btn btn-outline hidden">Sign Out</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Error Container -->
        <div id="error-container" class="alert alert-error hidden">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
            </svg>
            <span id="error-message"></span>
        </div>

        <!-- Success Container -->
        <div id="success-container" class="alert alert-success hidden">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
            <span id="success-message"></span>
        </div>

        <!-- Auth Section (shown when not signed in) -->
        <section id="auth-section" class="auth-section">
            <div class="auth-card">
                <h2>Welcome to ReduceMeetings</h2>
                <p>Analyze your calendar to identify which recurring meetings you can remove, keep, or follow up on.</p>
                <button id="sign-in-btn" class="btn microsoft-btn">
                    <svg width="20" height="20" viewBox="0 0 21 21" fill="none">
                        <rect width="10" height="10" fill="#F25022"/>
                        <rect x="11" width="10" height="10" fill="#7FBA00"/>
                        <rect y="11" width="10" height="10" fill="#00A4EF"/>
                        <rect x="11" y="11" width="10" height="10" fill="#FFB900"/>
                    </svg>
                    Sign in with Microsoft
                </button>

                <!-- Test Connection Area -->
                <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
                    <button id="test-connection-btn" class="btn btn-outline" style="width: 100%;">
                        Test Connection
                    </button>
                    <div id="test-result" class="test-result hidden"></div>
                </div>
            </div>
        </section>

        <!-- App Section (shown when signed in) -->
        <section id="app-section" class="app-section hidden">
            <!-- Controls Bar -->
            <div class="controls-bar">
                <div class="controls-row">
                    <div class="control-group">
                        <label for="months-select">Analysis Period:</label>
                        <select id="months-select">
                            <option value="1">1 month</option>
                            <option value="2" selected>2 months</option>
                            <option value="3">3 months</option>
                            <option value="6">6 months</option>
                            <option value="12">12 months</option>
                        </select>
                    </div>

                    <button id="analyze-btn" class="btn btn-primary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
                        </svg>
                        Start Analysis
                    </button>

                    <div class="control-group">
                        <label for="analysis-select">Previous Analyses:</label>
                        <select id="analysis-select">
                            <option value="">-- Select Previous Analysis --</option>
                        </select>
                    </div>

                    <div class="control-group">
                        <label for="compare-select">Compare With:</label>
                        <select id="compare-select" disabled>
                            <option value="">-- No Comparison --</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab-btn active" data-filter="all">All (0)</button>
                <button class="tab-btn" data-filter="keep">Keep (0)</button>
                <button class="tab-btn" data-filter="remove">Remove (0)</button>
                <button class="tab-btn" data-filter="follow">Follow (0)</button>
            </div>

            <!-- Bulk Actions -->
            <div class="bulk-actions">
                <label class="checkbox-container">
                    <input type="checkbox" id="select-all">
                    Select All
                </label>
                <span id="selected-count">0 selected</span>
                <div class="bulk-actions-buttons">
                    <button id="bulk-remove-btn" class="btn btn-danger" disabled>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                        </svg>
                        Remove Selected
                    </button>
                    <button id="export-btn" class="btn btn-outline" disabled>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                        </svg>
                        Export CSV
                    </button>
                    <button id="openai-settings-btn" class="btn btn-outline" title="OpenAI Settings">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        AI Settings
                    </button>
                </div>
            </div>

            <!-- Meetings Container -->
            <div id="meetings-container" class="meetings-container">
                <div class="empty-state">
                    <p>No analysis loaded. Click "Start Analysis" to analyze your calendar.</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>ReduceMeetings - Take control of your calendar</p>
        </div>
    </footer>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-spinner"></div>
        <p id="loading-message" class="loading-message">Loading...</p>
        <div class="progress-container">
            <div id="progress-bar" class="progress-bar"></div>
        </div>
        <p id="progress-text" class="loading-message" style="font-size: 0.875rem; color: var(--text-muted);"></p>
    </div>

    <!-- OpenAI API Key Modal -->
    <div id="openai-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>OpenAI API Key</h2>
                <button class="modal-close" id="openai-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Enter your OpenAI API key to enable AI-powered meeting recommendations.</p>
                <p class="modal-note">Your API key is stored locally in your browser and never sent to our servers.</p>
                <div class="form-group">
                    <label for="openai-key-input">API Key:</label>
                    <input type="password" id="openai-key-input" placeholder="sk-..." autocomplete="off">
                </div>
                <div class="form-group checkbox-group">
                    <label class="checkbox-container">
                        <input type="checkbox" id="save-key-checkbox" checked>
                        Remember API key in this browser
                    </label>
                </div>
                <div id="openai-key-status" class="key-status hidden"></div>
            </div>
            <div class="modal-footer">
                <button id="test-openai-btn" class="btn btn-outline">Test Connection</button>
                <button id="save-openai-btn" class="btn btn-primary">Save & Continue</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2 id="confirm-modal-title">Confirm Action</h2>
            </div>
            <div class="modal-body">
                <p id="confirm-modal-message">Are you sure?</p>
            </div>
            <div class="modal-footer">
                <button id="confirm-cancel-btn" class="btn btn-outline">Cancel</button>
                <button id="confirm-ok-btn" class="btn btn-danger">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Undo Toast -->
    <div id="undo-toast" class="undo-toast hidden">
        <span id="undo-message">Meetings removed</span>
        <button id="undo-btn" class="btn btn-small">Undo</button>
        <div class="undo-progress">
            <div id="undo-progress-bar" class="undo-progress-bar"></div>
        </div>
    </div>

    <!-- App Script (ES Module) -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
